"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,r=require("outstated"),n=require("@codegateinc/g-utils"),o=require("react"),i=(e=o)&&"object"==typeof e&&"default"in e?e.default:e,u=function(e){return(0,e.component)()},a=function(e){return(0,e.component)()},s=function(e){return(0,e.component)()},l={__proto__:null,Input:u,CheckBox:a,Picker:s};!function(e){e[e.Input=0]="Input",e[e.Picker=1]="Picker",e[e.CheckBox=2]="CheckBox"}(t||(t={}));var c={__proto__:null,get FormFieldType(){return t}};function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var d=function(){var e=o.useState({}),r=e[0],i=e[1],u=o.useState({}),a=u[0],s=u[1];return{actions:{setFormState:function(e,t){return i((function(r){var n;return f(f({},r),{},((n={})[e]=t,n))}))},setFormValue:function(e,t,o,u){var s,l;if(r[e]){var c=f(f({},r),{},((l={})[e]=f(f({},r[e]),{},((s={})[t]=f(f({},r[e][t]),{},{value:o}),s)),l));i((function(r){var n,i;return f(f({},r),{},((i={})[e]=f(f({},r[e]),{},((n={})[t]=f(f({},r[e][t]),{},{value:o}),n)),i))})),n.G.ifDefined(u,(function(t){return t(c[e])})),a[e]&&a[e][t]&&a[e][t](o)}},setFormError:function(e,t,n){return r[e]&&i((function(r){var o,i;return f(f({},r),{},((i={})[e]=f(f({},r[e]),{},((o={})[t]=f(f({},r[e][t]),{},{errorMessage:n}),o)),i))}))},setFormPristine:function(e,t,n){return r[e]&&i((function(r){var o,i;return f(f({},r),{},((i={})[e]=f(f({},r[e]),{},((o={})[t]=f(f({},r[e][t]),{},{isPristine:n}),o)),i))}))},setFormOptions:function(e,t,o,u){r[e]&&(i((function(r){var n,i,u=o.map((function(e){return e.value})),s=r[e][t].options.map((function(e){return f(f({},e),{},{isSelected:u.includes(e.value)})}));return a[e]&&a[e][t]&&a[e][t](s),f(f({},r),{},((i={})[e]=f(f({},r[e]),{},((n={})[t]=f(f({},r[e][t]),{},{options:s}),n)),i))})),n.G.ifDefined(u,(function(n){return n((a=o.map((function(e){return e.value})),s=r[e][t].options.map((function(e){return f(f({},e),{},{isSelected:a.includes(e.value)})})),f(f({},r),{},((u={})[e]=f(f({},r[e]),{},((i={})[t]=f(f({},r[e][t]),{},{options:s}),i)),u)))[e]);var i,u,a,s})))},setFormField:function(e,n,o){r[e]&&r[e][n]&&i((function(i){var u,a;return f(f({},i),{},((a={})[e]=f(f({},i[e]),{},((u={})[n]=f(f(f({type:r[e][n].type},r[e][n]),o),{},{options:o.options||(r[e][n].type===t.Picker?r[e][n].options:[])}),u)),a))}))},getFormField:function(e,t){return r[e]&&r[e][t]?r[e][t]:{}},onFormFieldChange:function(e,t,n){o.useEffect((function(){s((function(r){var o,i;return f(f({},r),{},((i={})[e]=f(f({},r[e]),{},((o={})[t]=n,o)),i))}))}),[r])},clearFormStore:function(e){i((function(t){var r;return f(f({},t),{},((r={})[e]={},r))})),s((function(t){var r;return f(f({},t),{},((r={})[e]={},r))}))}},state:{formState:r}}},v=function(){var e=o.useState({}),t=e[0],r=e[1],n=o.useState({}),i=n[1];return{actions:{setConfig:function(e,t){return r((function(r){var n;return f(f({},r),{},((n={})[e]=t,n))}))},clearConfigStore:function(e){return r((function(t){var r;return f(f({},t),{},((r={})[e]={},r))}))},setOnUpdate:function(e,t){return t&&i((function(r){var n;return f(f({},r),{},((n={})[e]=t,n))}))}},state:{configStore:t,configOnUpdate:n[0]}}},p=[v,d],m=function(){var e=r.useStore(d),o=r.useStore(v);return{validateField:function(t,r,n){var i=o.state.configStore&&o.state.configStore[t]&&o.state.configStore[t][r];if(!i.isRequired&&0===n.length)return e.actions.setFormError(t,r,void 0);if(null==i?void 0:i.validationRules){var u=i.validationRules.map((function(r){return r.validationFunction(n,e.state.formState[t])?r.errorMessage:void 0})).filter((function(e){return e}));e.actions.setFormError(t,r,u[0])}},validateCheckBox:function(t,r,n){var i=o.state.configStore&&o.state.configStore[t]&&o.state.configStore[t][r];if(null==i?void 0:i.validationRules){var u=i.validationRules[0],a=u.validationFunction(n,e.state.formState[t])?u.errorMessage:void 0;e.actions.setFormError(t,r,a)}},validatePicker:function(t,r,n){var i=o.state.configStore&&o.state.configStore[t]&&o.state.configStore[t][r],u=((null==i?void 0:i.validationRules)&&i.validationRules.map((function(r){return r.validationFunction(n,e.state.formState[t])?r.errorMessage:void 0}))||[void 0].filter((function(e){return e})))[0],a=(null==i?void 0:i.options)&&i.options.some((function(e){return e.isSelected}));if((null==i?void 0:i.isRequired)&&a)return e.actions.setFormError(t,r,u);e.actions.setFormError(t,r,u)},validateForm:function(r,i){return void 0===i&&(i=!0),e.state.formState[r]?n.G.toPairs(e.state.formState[r]).map((function(n){var u=n[0],a=n[1],s=o.state.configStore&&o.state.configStore[r][u];if((null==s?void 0:s.validationRules)&&a.type===t.Input){var l=a.value;if(!a.isRequired&&""===l)return;var c=s.validationRules.map((function(t){return t.validationFunction(l,e.state.formState[r])?t.errorMessage:void 0})).filter((function(e){return e}))[0];return i&&e.actions.setFormError(r,u,c),c}if((null==s?void 0:s.validationRules)&&a.type===t.CheckBox){if(!a.isRequired)return;var f=s.validationRules[0],d=f.validationFunction(a.value,e.state.formState[r])?f.errorMessage:void 0;return i&&e.actions.setFormError(r,u,d),d}if((null==s?void 0:s.validationRules)&&a.type===t.Picker){var v=a.options;if(!a.isRequired)return;var p=s.validationRules.map((function(t){return t.validationFunction(v,e.state.formState[r])?t.errorMessage:void 0})).filter((function(e){return e}))[0];return i&&e.actions.setFormError(r,u,p),p}})):[]}}},g=function(){var e,t,o,i=(e=r.useStore(d),t=r.useStore(v),o=m().validateField,{onInputBlur:function(r,n,i){var u=t.state.configStore&&t.state.configStore[r][n];(e.state.formState[r][n].isRequired||i!==(null==u?void 0:u.value))&&e.actions.setFormPristine(r,n,!1),o(r,n,i)}}).onInputBlur,u=function(){var e=r.useStore(d),t=e.state,o=e.actions,i=r.useStore(v),u=m(),a=u.validateField,s=u.validateCheckBox,l=u.validatePicker;return{onInputChange:function(e,r,n,u){var s=t.formState[e][r],l=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][r],c=(null==l?void 0:l.liveParser)?l.liveParser(n):n;if("string"!=typeof c)throw new Error("liveParser must return string on input");(s.errorMessage||!s.isPristine||l.forceLiveValidate||l.validationRules)&&a(e,r,c),o.setFormValue(e,r,c,u)},onCheckboxChange:function(e,r,n){var u=t.formState[e][r],a=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][r],l=(null==a?void 0:a.liveParser)?a.liveParser(!u.value):!u.value;if("boolean"!=typeof l)throw new Error("liveParser must return boolean on checkbox");(u.isRequired&&!u.isPristine||u.errorMessage||a.validationRules)&&s(e,r,l),o.setFormValue(e,r,l,n)},onPickerChange:function(e,t,r,u){var a=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][t],s=(null==a?void 0:a.liveParser)?a.liveParser(r):r;if(!n.G.is(Array,s))throw new Error("liveParser must return array on picker");l(e,t,r),o.setFormOptions(e,t,r,u)}}}();return{input:{onBlur:i,onChange:u.onInputChange},checkBox:{onChange:u.onCheckboxChange},picker:{onChange:u.onPickerChange}}},S=function(e,r){void 0===r&&(r=!1);var o=n.G.toPairs(e).map((function(e){var n,o=e[0],i=e[1];if((null==i?void 0:i.isRequired)&&!(null==i?void 0:i.validationRules))throw new Error("validationRules are required if field isRequired  ");return i.type===t.Input?[o,{value:r?"":i.value||"",isRequired:(null==i?void 0:i.isRequired)||!1,isPristine:!0,disabled:(null==i?void 0:i.disabled)||!1,type:i.type,errorMessage:void 0}]:i.type===t.CheckBox?[o,{value:!r&&(i.value||!1),isRequired:(null==i?void 0:i.isRequired)||!1,isPristine:!0,disabled:(null==i?void 0:i.disabled)||!1,type:i.type,errorMessage:void 0}]:i.type===t.Picker?[o,{isRequired:(null==i?void 0:i.isRequired)||!1,isPristine:!0,disabled:(null==i?void 0:i.disabled)||!1,type:i.type,errorMessage:void 0,options:r?(null===(n=i.options)||void 0===n?void 0:n.map((function(e){return f(f({},e),{},{isSelected:!1})})))||[]:i.options||[]}]:void 0}));return n.G.fromPairs(o)},F=function(e){return e&&n.G.toPairs(e).reduce((function(e,r){var n=r[0],o=r[1];if(o.type===t.Input||o.type===t.CheckBox){var i,u=o.value;return f(f({},e),{},((i={})[n]=u,i))}if(o.type===t.Picker){var a,s=o.options.filter((function(e){return e.isSelected})).map((function(e){return e.value}));return f(f({},e),{},((a={})[n]=s,a))}return e}),{})};exports.Field=l,exports.Form=function(e){return i.createElement(o.Fragment,null,function(e,t){if(!e)throw new Error("children are mandatory");return i.Children.map(e,(function(e){return function e(t,o){if("string"==typeof t||"number"==typeof t||null===typeof t)return t;var l=r.useStore(d).state,c=r.useStore(v).state.configOnUpdate,p=t;if(p.type===u){var m=g().input,S=t,h=S.props.formFieldName,P=l.formState[o],y=P?P[h]:void 0;return i.cloneElement(S,f(f({},S.props),{},{component:function(){return S.props.component({value:(null==y?void 0:y.value)||"",onChangeText:function(e){return m.onChange(o,h,e,(function(e){n.G.ifDefined(c[o],(function(t){return t(F(e))}))}))},onBlur:function(){return m.onBlur(o,h,(null==y?void 0:y.value)||"")},errorMessage:null==y?void 0:y.errorMessage,disabled:(null==y?void 0:y.disabled)||!1,isPristine:(null==y?void 0:y.isPristine)||!0})}}))}if(p.type===a){var C=g().checkBox,R=t,k=R.props.formFieldName,b=l.formState[o],E=b?b[k]:void 0;return i.cloneElement(R,f(f({},R.props),{},{component:function(){return R.props.component({value:(null==E?void 0:E.value)||!1,onChange:function(){return C.onChange(o,k,(function(e){n.G.ifDefined(c[o],(function(t){return t(F(e))}))}))},errorMessage:null==E?void 0:E.errorMessage,disabled:(null==E?void 0:E.disabled)||!1,isPristine:(null==E?void 0:E.isPristine)||!0})}}))}if(p.type===s){var x=g().picker,q=t,M=q.props.formFieldName,G=l.formState[o],B=G?G[M]:void 0;return i.cloneElement(q,f(f({},q.props),{},{component:function(){return q.props.component({onChange:function(e){return x.onChange(o,M,e,(function(e){n.G.ifDefined(c[o],(function(t){return t(F(e))}))}))},errorMessage:null==B?void 0:B.errorMessage,disabled:(null==B?void 0:B.disabled)||!1,isPristine:(null==B?void 0:B.isPristine)||!0,options:(null==B?void 0:B.options)||[]})}}))}var w=p.props.children;if(w){var I=i.Children.map(w,(function(t){return e(t,o)}));return i.cloneElement(p,p.props,I)}return p}(e,t)}))}(e.children,e.formName))},exports.FormProvider=function(e){return i.createElement(r.Provider,{stores:p},e.children)},exports.FormTypes=c,exports.useForm=function(e){var t=e.formName,i=e.formConfig,u=e.onError,a=e.onSuccess,s=e.onUpdate,l=r.useStore(d),c=l.state,f=l.actions,p=r.useStore(v),g=m().validateForm;return o.useEffect((function(){var e=S(i);return p.actions.setConfig(t,i),p.actions.setOnUpdate(t,s),f.setFormState(t,e),function(){p.actions.clearConfigStore(t),f.clearFormStore(t)}}),[]),{submitForm:function(){var e=g(t);if(e.some((function(e){return e})))return n.G.ifDefined(u,(function(t){return t(e)}));var r=F(c.formState[t]);return n.G.ifDefined(a,(function(e){return e(r)}))},hasChanges:c.formState[t]&&n.G.toPairs(c.formState[t]).some((function(e){return!e[1].isPristine})),setField:function(e,r){return f.setFormField(t,e,r)},isFormValid:!g(t,!1).some((function(e){return e})),getField:function(e){return f.getFormField(t,e)},subscribe:function(e){return{onChange:function(r){return f.onFormFieldChange(t,e,r)}}},restoreToInitial:function(){if(p.state.configStore){var e=S(p.state.configStore[t]);f.setFormState(t,e),n.G.ifDefined(s,(function(t){return t(F(e))}))}},clearForm:function(){if(p.state.configStore){var e=S(p.state.configStore[t],!0);f.setFormState(t,e),n.G.ifDefined(s,(function(t){return t(F(e))}))}},isFormReady:n.G.hasKeys(c.formState[t])}};
//# sourceMappingURL=react-form-builder.cjs.production.min.js.map
