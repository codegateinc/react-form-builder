!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("outstated"),require("@codegateinc/g-utils"),require("react")):"function"==typeof define&&define.amd?define(["exports","outstated","@codegateinc/g-utils","react"],t):t((e=e||self)["@codegateinc/react-form-builder"]={},e.outstated,e.gUtils,e.React)}(this,(function(e,t,n,r){"use strict";var o,i="default"in r?r.default:r,u=function(e){return(0,e.component)()},a=function(e){return(0,e.component)()},s=function(e){return(0,e.component)()},c={__proto__:null,Input:u,CheckBox:a,Picker:s};!function(e){e[e.Input=0]="Input",e[e.Picker=1]="Picker",e[e.CheckBox=2]="CheckBox"}(o||(o={}));var f={__proto__:null,get FormFieldType(){return o}};function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var d=function(){var e=r.useState({}),t=e[0],i=e[1],u=r.useState({}),a=u[0],s=u[1];return{actions:{setFormState:function(e,t){return i((function(n){var r;return l(l({},n),{},((r={})[e]=t,r))}))},setFormValue:function(e,r,o,u){var s,c;if(t[e]){var f=l(l({},t),{},((c={})[e]=l(l({},t[e]),{},((s={})[r]=l(l({},t[e][r]),{},{value:o}),s)),c));i((function(t){var n,i;return l(l({},t),{},((i={})[e]=l(l({},t[e]),{},((n={})[r]=l(l({},t[e][r]),{},{value:o}),n)),i))})),n.G.ifDefined(u,(function(t){return t(f[e])})),a[e]&&a[e][r]&&a[e][r](o)}},setFormError:function(e,n,r){return t[e]&&i((function(t){var o,i;return l(l({},t),{},((i={})[e]=l(l({},t[e]),{},((o={})[n]=l(l({},t[e][n]),{},{errorMessage:r}),o)),i))}))},setFormPristine:function(e,n,r){return t[e]&&i((function(t){var o,i;return l(l({},t),{},((i={})[e]=l(l({},t[e]),{},((o={})[n]=l(l({},t[e][n]),{},{isPristine:r}),o)),i))}))},setFormOptions:function(e,r,o,u){t[e]&&(i((function(t){var n,i,u=o.map((function(e){return e.value})),s=t[e][r].options.map((function(e){return l(l({},e),{},{isSelected:u.includes(e.value)})}));return a[e]&&a[e][r]&&a[e][r](s),l(l({},t),{},((i={})[e]=l(l({},t[e]),{},((n={})[r]=l(l({},t[e][r]),{},{options:s}),n)),i))})),n.G.ifDefined(u,(function(n){return n((a=o.map((function(e){return e.value})),s=t[e][r].options.map((function(e){return l(l({},e),{},{isSelected:a.includes(e.value)})})),l(l({},t),{},((u={})[e]=l(l({},t[e]),{},((i={})[r]=l(l({},t[e][r]),{},{options:s}),i)),u)))[e]);var i,u,a,s})))},setFormField:function(e,n,r){t[e]&&t[e][n]&&i((function(i){var u,a;return l(l({},i),{},((a={})[e]=l(l({},i[e]),{},((u={})[n]=l(l(l({type:t[e][n].type},t[e][n]),r),{},{options:r.options||(t[e][n].type===o.Picker?t[e][n].options:[])}),u)),a))}))},getFormField:function(e,n){return t[e]&&t[e][n]?t[e][n]:{}},onFormFieldChange:function(e,n,o){r.useEffect((function(){s((function(t){var r,i;return l(l({},t),{},((i={})[e]=l(l({},t[e]),{},((r={})[n]=o,r)),i))}))}),[t])},clearFormStore:function(e){i((function(t){var n;return l(l({},t),{},((n={})[e]={},n))})),s((function(t){var n;return l(l({},t),{},((n={})[e]={},n))}))}},state:{formState:t}}},v=function(){var e=r.useState({}),t=e[0],n=e[1],o=r.useState({}),i=o[1];return{actions:{setConfig:function(e,t){return n((function(n){var r;return l(l({},n),{},((r={})[e]=t,r))}))},clearConfigStore:function(e){return n((function(t){var n;return l(l({},t),{},((n={})[e]={},n))}))},setOnUpdate:function(e,t){return t&&i((function(n){var r;return l(l({},n),{},((r={})[e]=t,r))}))}},state:{configStore:t,configOnUpdate:o[0]}}},p=[v,d],m=function(){var e=t.useStore(d),r=t.useStore(v);return{validateField:function(t,n,o){var i=r.state.configStore&&r.state.configStore[t]&&r.state.configStore[t][n];if(null==i?void 0:i.validationRules){var u=i.validationRules.map((function(n){return n.validationFunction(o,e.state.formState[t])?n.errorMessage:void 0})).filter((function(e){return e}));e.actions.setFormError(t,n,u[0])}},validateCheckBox:function(t,n,o){var i=r.state.configStore&&r.state.configStore[t]&&r.state.configStore[t][n];if(null==i?void 0:i.validationRules){var u=i.validationRules[0],a=u.validationFunction(o,e.state.formState[t])?u.errorMessage:void 0;e.actions.setFormError(t,n,a)}},validatePicker:function(t,n,o){var i=r.state.configStore&&r.state.configStore[t]&&r.state.configStore[t][n],u=((null==i?void 0:i.validationRules)&&i.validationRules.map((function(n){return n.validationFunction(o,e.state.formState[t])?n.errorMessage:void 0}))||[void 0].filter((function(e){return e})))[0],a=(null==i?void 0:i.options)&&i.options.some((function(e){return e.isSelected}));if((null==i?void 0:i.isRequired)&&a)return e.actions.setFormError(t,n,u);e.actions.setFormError(t,n,u)},validateForm:function(t,i){return void 0===i&&(i=!0),e.state.formState[t]?n.G.toPairs(e.state.formState[t]).map((function(n){var u=n[0],a=n[1],s=r.state.configStore&&r.state.configStore[t][u];if((null==s?void 0:s.validationRules)&&a.type===o.Input){var c=a.value,f=s.validationRules.map((function(n){return n.validationFunction(c,e.state.formState[t])?n.errorMessage:void 0})).filter((function(e){return e}))[0];return i&&e.actions.setFormError(t,u,f),f}if((null==s?void 0:s.validationRules)&&a.type===o.CheckBox){var l=s.validationRules[0],d=l.validationFunction(a.value,e.state.formState[t])?l.errorMessage:void 0;return i&&e.actions.setFormError(t,u,d),d}if((null==s?void 0:s.validationRules)&&a.type===o.Picker){var v=a.options,p=s.validationRules.map((function(n){return n.validationFunction(v,e.state.formState[t])?n.errorMessage:void 0})).filter((function(e){return e}))[0];return i&&e.actions.setFormError(t,u,p),p}})):[]}}},g=function(){var e,r,o,i=(e=t.useStore(d),r=t.useStore(v),o=m().validateField,{onInputBlur:function(t,n,i){var u=r.state.configStore&&r.state.configStore[t][n];(e.state.formState[t][n].isRequired||i!==(null==u?void 0:u.value))&&e.actions.setFormPristine(t,n,!1),o(t,n,i)}}).onInputBlur,u=function(){var e=t.useStore(d),r=e.state,o=e.actions,i=t.useStore(v),u=m(),a=u.validateField,s=u.validateCheckBox,c=u.validatePicker;return{onInputChange:function(e,t,n,u){var s=r.formState[e][t],c=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][t],f=(null==c?void 0:c.liveParser)?c.liveParser(n):n;if("string"!=typeof f)throw new Error("liveParser must return string on input");(s.errorMessage||!s.isPristine||c.forceLiveValidate)&&a(e,t,f),o.setFormValue(e,t,f,u)},onCheckboxChange:function(e,t,n){var u=r.formState[e][t],a=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][t],c=(null==a?void 0:a.liveParser)?a.liveParser(!u.value):!u.value;if("boolean"!=typeof c)throw new Error("liveParser must return boolean on checkbox");(u.isRequired&&!u.isPristine||u.errorMessage)&&s(e,t,c),o.setFormValue(e,t,c,n)},onPickerChange:function(e,t,r,u){var a=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][t],s=(null==a?void 0:a.liveParser)?a.liveParser(r):r;if(!n.G.is(Array,s))throw new Error("liveParser must return array on picker");c(e,t,r),o.setFormOptions(e,t,r,u)}}}();return{input:{onBlur:i,onChange:u.onInputChange},checkBox:{onChange:u.onCheckboxChange},picker:{onChange:u.onPickerChange}}},S=function(e,t){void 0===t&&(t=!1);var r=n.G.toPairs(e).map((function(e){var n,r=e[0],i=e[1];if((null==i?void 0:i.isRequired)&&!(null==i?void 0:i.validationRules))throw new Error("validationRules are required if field isRequired  ");return i.type===o.Input||i.type===o.CheckBox?[r,{value:t?i.type===o.Input&&"":i.value||"",isRequired:(null==i?void 0:i.isRequired)||!1,isPristine:!0,disabled:(null==i?void 0:i.disabled)||!1,type:i.type,errorMessage:void 0}]:i.type===o.Picker?[r,{isRequired:(null==i?void 0:i.isRequired)||!1,isPristine:!0,disabled:(null==i?void 0:i.disabled)||!1,type:i.type,errorMessage:void 0,options:t?(null===(n=i.options)||void 0===n?void 0:n.map((function(e){return l(l({},e),{},{isSelected:!1})})))||[]:i.options||[]}]:void 0}));return n.G.fromPairs(r)},F=function(e){return e&&n.G.toPairs(e).reduce((function(e,t){var n=t[0],r=t[1];if(r.type===o.Input||r.type===o.CheckBox){var i,u=r.value;return l(l({},e),{},((i={})[n]=u,i))}if(r.type===o.Picker){var a,s=r.options.filter((function(e){return e.isSelected})).map((function(e){return e.value}));return l(l({},e),{},((a={})[n]=s,a))}return e}),{})};e.Field=c,e.Form=function(e){return i.createElement(r.Fragment,null,function(e,r){if(!e)throw new Error("children are mandatory");return i.Children.map(e,(function(e){return function e(r,o){if("string"==typeof r||"number"==typeof r||null===typeof r)return r;var c=t.useStore(d).state,f=t.useStore(v).state.configOnUpdate,p=r;if(p.type===u){var m=g().input,S=r,h=S.props.formFieldName,P=c.formState[o],y=P?P[h]:void 0;return i.cloneElement(S,l(l({},S.props),{},{component:function(){return S.props.component({value:(null==y?void 0:y.value)||"",onChangeText:function(e){return m.onChange(o,h,e,(function(e){n.G.ifDefined(f[o],(function(t){return t(F(e))}))}))},onBlur:function(){return m.onBlur(o,h,(null==y?void 0:y.value)||"")},errorMessage:null==y?void 0:y.errorMessage,disabled:(null==y?void 0:y.disabled)||!1,isPristine:(null==y?void 0:y.isPristine)||!0})}}))}if(p.type===a){var C=g().checkBox,k=r,R=k.props.formFieldName,b=c.formState[o],E=b?b[R]:void 0;return i.cloneElement(k,l(l({},k.props),{},{component:function(){return k.props.component({value:(null==E?void 0:E.value)||!1,onChange:function(){return C.onChange(o,R,(function(e){n.G.ifDefined(f[o],(function(t){return t(F(e))}))}))},errorMessage:null==E?void 0:E.errorMessage,disabled:(null==E?void 0:E.disabled)||!1,isPristine:(null==E?void 0:E.isPristine)||!0})}}))}if(p.type===s){var M=g().picker,x=r,G=x.props.formFieldName,B=c.formState[o],q=B?B[G]:void 0;return i.cloneElement(x,l(l({},x.props),{},{component:function(){return x.props.component({onChange:function(e){return M.onChange(o,G,e,(function(e){n.G.ifDefined(f[o],(function(t){return t(F(e))}))}))},errorMessage:null==q?void 0:q.errorMessage,disabled:(null==q?void 0:q.disabled)||!1,isPristine:(null==q?void 0:q.isPristine)||!0,options:(null==q?void 0:q.options)||[]})}}))}var I=p.props.children;if(I){var w=i.Children.map(I,(function(t){return e(t,o)}));return i.cloneElement(p,p.props,w)}return p}(e,r)}))}(e.children,e.formName))},e.FormProvider=function(e){return i.createElement(t.Provider,{stores:p},e.children)},e.FormTypes=f,e.useForm=function(e){var o=e.formName,i=e.formConfig,u=e.onError,a=e.onSuccess,s=e.onUpdate,c=t.useStore(d),f=c.state,l=c.actions,p=t.useStore(v),g=m().validateForm;return r.useEffect((function(){var e=S(i);return p.actions.setConfig(o,i),p.actions.setOnUpdate(o,s),l.setFormState(o,e),function(){p.actions.clearConfigStore(o),l.clearFormStore(o)}}),[]),{submitForm:function(){if(g(o).some((function(e){return e})))return n.G.ifDefined(u,n.G.call);var e=F(f.formState[o]);return n.G.ifDefined(a,(function(t){return t(e)}))},hasChanges:f.formState[o]&&n.G.toPairs(f.formState[o]).some((function(e){return!e[1].isPristine})),setField:function(e,t){return l.setFormField(o,e,t)},isFormValid:!g(o,!1).some((function(e){return e})),getField:function(e){return l.getFormField(o,e)},subscribe:function(e){return{onChange:function(t){return l.onFormFieldChange(o,e,t)}}},restoreToInitial:function(){if(p.state.configStore){var e=S(p.state.configStore[o]);l.setFormState(o,e),n.G.ifDefined(s,(function(t){return t(F(e))}))}},clearForm:function(){if(p.state.configStore){var e=S(p.state.configStore[o],!0);l.setFormState(o,e),n.G.ifDefined(s,(function(t){return t(F(e))}))}},isFormReady:n.G.hasKeys(f.formState[o])}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-form-builder.umd.production.min.js.map
