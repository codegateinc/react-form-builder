!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("outstated"),require("@codegateinc/g-utils"),require("react")):"function"==typeof define&&define.amd?define(["exports","outstated","@codegateinc/g-utils","react"],t):t((e=e||self)["@codegateinc/react-form-builder"]={},e.outstated,e.gUtils,e.React)}(this,(function(e,t,r,n){"use strict";var o,i="default"in n?n.default:n;!function(e){e[e.Input=0]="Input",e[e.Picker=1]="Picker",e[e.CheckBox=2]="CheckBox"}(o||(o={}));var u={__proto__:null,get FormFieldType(){return o}};function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var s=function(){var e=n.useState({}),t=e[0],i=e[1],u=n.useState({}),s=u[0],l=u[1];return{actions:{setFormState:function(e,t){return i((function(r){var n;return a(a({},r),{},((n={})[e]=t,n))}))},setFormValue:function(e,n,o,u){var l,c;if(t[e]){var f=a(a({},t),{},((c={})[e]=a(a({},t[e]),{},((l={})[n]=a(a({},t[e][n]),{},{value:o}),l)),c));i((function(t){var r,i;return a(a({},t),{},((i={})[e]=a(a({},t[e]),{},((r={})[n]=a(a({},t[e][n]),{},{value:o}),r)),i))})),r.G.ifDefined(u,(function(t){return t(f[e])})),s[e]&&s[e][n]&&s[e][n](o)}},setFormError:function(e,r,n){return t[e]&&i((function(t){var o,i;return a(a({},t),{},((i={})[e]=a(a({},t[e]),{},((o={})[r]=a(a({},t[e][r]),{},{errorMessage:n}),o)),i))}))},setFormPristine:function(e,r,n){return t[e]&&i((function(t){var o,i;return a(a({},t),{},((i={})[e]=a(a({},t[e]),{},((o={})[r]=a(a({},t[e][r]),{},{isPristine:n}),o)),i))}))},setFormOptions:function(e,n,o,u){t[e]&&(i((function(t){var r,i,u=o.map((function(e){return e.value})),l=t[e][n].options.map((function(e){return a(a({},e),{},{isSelected:u.includes(e.value)})}));return s[e]&&s[e][n]&&s[e][n](l),a(a({},t),{},((i={})[e]=a(a({},t[e]),{},((r={})[n]=a(a({},t[e][n]),{},{options:l}),r)),i))})),r.G.ifDefined(u,(function(r){return r((s=o.map((function(e){return e.value})),l=t[e][n].options.map((function(e){return a(a({},e),{},{isSelected:s.includes(e.value)})})),a(a({},t),{},((u={})[e]=a(a({},t[e]),{},((i={})[n]=a(a({},t[e][n]),{},{options:l}),i)),u)))[e]);var i,u,s,l})))},setFormField:function(e,r,n){t[e]&&t[e][r]&&i((function(i){var u,s;return a(a({},i),{},((s={})[e]=a(a({},i[e]),{},((u={})[r]=a(a(a({},t[e][r]),n),{},{type:t[e][r].type,options:n.options||(t[e][r].type===o.Picker?t[e][r].options:[])}),u)),s))}))},getFormField:function(e,r){return t[e]&&t[e][r]?t[e][r]:{}},onFormFieldChange:function(e,r,o){n.useEffect((function(){l((function(t){var n,i;return a(a({},t),{},((i={})[e]=a(a({},t[e]),{},((n={})[r]=o,n)),i))}))}),[t])},clearFormStore:function(e){i((function(t){var r;return a(a({},t),{},((r={})[e]={},r))})),l((function(t){var r;return a(a({},t),{},((r={})[e]={},r))}))}},state:{formState:t}}},l=function(){var e=n.useState({}),t=e[0],r=e[1],i=n.useState({}),u=i[1];return{actions:{setConfig:function(e,t){return r((function(r){var n;return a(a({},r),{},((n={})[e]=t,n))}))},clearConfigStore:function(e){return r((function(t){var r;return a(a({},t),{},((r={})[e]={},r))}))},setOnUpdate:function(e,t){return t&&u((function(r){var n;return a(a({},r),{},((n={})[e]=t,n))}))},setConfigFormField:function(e,n,i){t[e]&&t[e][n]&&r((function(r){var u,s;return a(a({},r),{},((s={})[e]=a(a({},r[e]),{},((u={})[n]=a(a(a({},t[e][n]),i),{},{type:t[e][n].type,options:i.options||(t[e][n].type===o.Picker?t[e][n].options:[])}),u)),s))}))}},state:{configStore:t,configOnUpdate:i[0]}}},c=[l,s],f=function(){var e=t.useStore(s),n=t.useStore(l);return{validateField:function(t,r,o){var i=n.state.configStore&&n.state.configStore[t]&&n.state.configStore[t][r];if(null==i?void 0:i.validationRules){var u=i.validationRules.map((function(r){return r.validationFunction(o,e.state.formState[t])?r.errorMessage:void 0})).filter((function(e){return e}));e.actions.setFormError(t,r,u[0])}},validateCheckBox:function(t,r,o){var i=n.state.configStore&&n.state.configStore[t]&&n.state.configStore[t][r];if(null==i?void 0:i.validationRules){var u=i.validationRules[0],a=u.validationFunction(o,e.state.formState[t])?u.errorMessage:void 0;e.actions.setFormError(t,r,a)}},validatePicker:function(t,r,o){var i=n.state.configStore&&n.state.configStore[t]&&n.state.configStore[t][r],u=((null==i?void 0:i.validationRules)&&i.validationRules.map((function(r){return r.validationFunction(o,e.state.formState[t])?r.errorMessage:void 0}))||[void 0].filter((function(e){return e})))[0],a=(null==i?void 0:i.options)&&i.options.some((function(e){return e.isSelected}));if((null==i?void 0:i.isRequired)&&a)return e.actions.setFormError(t,r,void 0);e.actions.setFormError(t,r,u)},validateForm:function(t,i){return void 0===i&&(i=!0),e.state.formState[t]?r.G.toPairs(e.state.formState[t]).map((function(r){var u=r[0],a=r[1],s=n.state.configStore&&n.state.configStore[t][u];if((null==s?void 0:s.validationRules)&&a.type===o.Input){var l=a.value;if(!a.isRequired&&""===l)return;var c=s.validationRules.map((function(r){return r.validationFunction(l,e.state.formState[t])?r.errorMessage:void 0})).filter((function(e){return e}))[0];return i&&e.actions.setFormError(t,u,c),c}if((null==s?void 0:s.validationRules)&&a.type===o.CheckBox){if(!a.isRequired)return;var f=s.validationRules[0],d=f.validationFunction(a.value,e.state.formState[t])?f.errorMessage:void 0;return i&&e.actions.setFormError(t,u,d),d}if((null==s?void 0:s.validationRules)&&a.type===o.Picker){var v=a.options;if(!a.isRequired)return;var p=s.validationRules.map((function(r){return r.validationFunction(v,e.state.formState[t])?r.errorMessage:void 0})).filter((function(e){return e}))[0];return i&&e.actions.setFormError(t,u,p),p}})):[]}}},d=function(){var e,n,o,i=(e=t.useStore(s),n=t.useStore(l),o=f().validateField,{onInputBlur:function(t,r,i){var u=n.state.configStore&&n.state.configStore[t][r];(e.state.formState[t][r].isRequired||i!==(null==u?void 0:u.value))&&e.actions.setFormPristine(t,r,!1),o(t,r,i)}}).onInputBlur,u=function(){var e=t.useStore(s),n=e.state,o=e.actions,i=t.useStore(l),u=f(),c=u.validateField,d=u.validateCheckBox,v=u.validatePicker;return{onInputChange:function(e,t,r,u){var a=n.formState[e][t],s=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][t],l=(null==s?void 0:s.liveParser)?s.liveParser(r):r;if("string"!=typeof l)throw new Error("liveParser must return string on input");(a.errorMessage||!a.isPristine||s.forceLiveValidate)&&c(e,t,l),o.setFormValue(e,t,l,u)},onCheckboxChange:function(e,t,r){var u=n.formState[e][t],a=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][t],s=(null==a?void 0:a.liveParser)?a.liveParser(!u.value):!u.value;if("boolean"!=typeof s)throw new Error("liveParser must return boolean on checkbox");(u.isRequired&&!u.isPristine||u.errorMessage||a.validationRules)&&d(e,t,s),o.setFormValue(e,t,s,r)},onPickerChange:function(e,t,n,u){var s,l=i.state.configStore&&i.state.configStore[e]&&i.state.configStore[e][t],c=n.map((function(e){return e.value})),f=null==l||null===(s=l.options)||void 0===s?void 0:s.map((function(e){return a(a({},e),{},{isSelected:c.includes(e.value)})})),d=(null==l?void 0:l.liveParser)?l.liveParser(n):n;if(!r.G.is(Array,d))throw new Error("liveParser must return array on picker");v(e,t,f||[]),o.setFormOptions(e,t,d,u)}}}();return{input:{onBlur:i,onChange:u.onInputChange},checkBox:{onChange:u.onCheckboxChange},picker:{onChange:u.onPickerChange}}},v=function(e,t){void 0===t&&(t=!1);var n=r.G.toPairs(e).map((function(e){var r,n=e[0],i=e[1];if((null==i?void 0:i.isRequired)&&!(null==i?void 0:i.validationRules))throw new Error("validationRules are required if field isRequired  ");return i.type===o.Input?[n,{value:t?"":i.value||"",isRequired:(null==i?void 0:i.isRequired)||!1,isPristine:!0,disabled:(null==i?void 0:i.disabled)||!1,type:i.type,errorMessage:void 0}]:i.type===o.CheckBox?[n,{value:!t&&(i.value||!1),isRequired:(null==i?void 0:i.isRequired)||!1,isPristine:!0,disabled:(null==i?void 0:i.disabled)||!1,type:i.type,errorMessage:void 0}]:i.type===o.Picker?[n,{isRequired:(null==i?void 0:i.isRequired)||!1,isPristine:!0,disabled:(null==i?void 0:i.disabled)||!1,type:i.type,errorMessage:void 0,options:t?(null===(r=i.options)||void 0===r?void 0:r.map((function(e){return a(a({},e),{},{isSelected:!1})})))||[]:i.options||[]}]:void 0}));return r.G.fromPairs(n)},p=function(e){return e&&r.G.toPairs(e).reduce((function(e,t){var r=t[0],n=t[1];if(n.type===o.Input||n.type===o.CheckBox){var i,u=n.value;return a(a({},e),{},((i={})[r]=u,i))}if(n.type===o.Picker){var s,l=n.options.filter((function(e){return e.isSelected})).map((function(e){return e.value}));return a(a({},e),{},((s={})[r]=l,s))}return e}),{})};e.Field={__proto__:null,Input:function(e){return(0,e.component)()},CheckBox:function(e){return(0,e.component)()},Picker:function(e){return(0,e.component)()}},e.Form=function(e){return i.createElement(n.Fragment,null,function(e,n){if(!e)throw new Error("children are mandatory");return i.Children.map(e,(function(e){return function e(n,u){var c;if("string"==typeof n||"number"==typeof n||null===typeof n)return n;var f=t.useStore(s).state,v=t.useStore(l).state,m=v.configOnUpdate,g=n,S=v.configStore[u],F=S?null===(c=S[g.props.formFieldName])||void 0===c?void 0:c.type:void 0;if(F===o.Input){var h=d().input,P=n,y=P.props.formFieldName,C=f.formState[u],R=C?C[y]:void 0;return i.cloneElement(P,a(a({},P.props),{},{component:function(){return P.props.component({value:(null==R?void 0:R.value)||"",onChangeText:function(e){return h.onChange(u,y,e,(function(e){r.G.ifDefined(m[u],(function(t){return t(p(e))}))}))},onBlur:function(){return h.onBlur(u,y,(null==R?void 0:R.value)||"")},errorMessage:null==R?void 0:R.errorMessage,disabled:(null==R?void 0:R.disabled)||!1,isPristine:(null==R?void 0:R.isPristine)||!0})}}))}if(F===o.CheckBox){var k=d().checkBox,b=n,E=b.props.formFieldName,M=f.formState[u],q=M?M[E]:void 0;return i.cloneElement(b,a(a({},b.props),{},{component:function(){return b.props.component({value:(null==q?void 0:q.value)||!1,onChange:function(){return k.onChange(u,E,(function(e){r.G.ifDefined(m[u],(function(t){return t(p(e))}))}))},errorMessage:null==q?void 0:q.errorMessage,disabled:(null==q?void 0:q.disabled)||!1,isPristine:(null==q?void 0:q.isPristine)||!0})}}))}if(F===o.Picker){var x=d().picker,B=n,G=B.props.formFieldName,I=f.formState[u],w=I?I[G]:void 0;return i.cloneElement(B,a(a({},B.props),{},{component:function(){return B.props.component({onChange:function(e){return x.onChange(u,G,e,(function(e){r.G.ifDefined(m[u],(function(t){return t(p(e))}))}))},errorMessage:null==w?void 0:w.errorMessage,disabled:(null==w?void 0:w.disabled)||!1,isPristine:(null==w?void 0:w.isPristine)||!0,options:(null==w?void 0:w.options)||[]})}}))}var O=g.props.children;if(O){var _=i.Children.map(O,(function(t){return e(t,u)}));return i.cloneElement(g,g.props,_)}return g}(e,n)}))}(e.children,e.formName))},e.FormProvider=function(e){return i.createElement(t.Provider,{stores:c},e.children)},e.FormTypes=u,e.useForm=function(e){var o=e.formName,i=e.formConfig,u=e.onError,a=e.onSuccess,c=e.onUpdate,d=t.useStore(s),m=d.state,g=d.actions,S=t.useStore(l),F=f().validateForm;return n.useEffect((function(){var e=v(i);return S.actions.setConfig(o,i),S.actions.setOnUpdate(o,c),g.setFormState(o,e),function(){S.actions.clearConfigStore(o),g.clearFormStore(o)}}),[]),{submitForm:function(){var e=F(o);if(e.some((function(e){return e})))return r.G.ifDefined(u,(function(t){return t(e)}));var t=p(m.formState[o]);return r.G.ifDefined(a,(function(e){return e(t)}))},hasChanges:m.formState[o]&&r.G.toPairs(m.formState[o]).some((function(e){return!e[1].isPristine})),setField:function(e,t){g.setFormField(o,e,t),S.actions.setConfigFormField(o,e,t)},isFormValid:!F(o,!1).some((function(e){return e})),getField:function(e){return g.getFormField(o,e)},subscribe:function(e){return{onChange:function(t){return g.onFormFieldChange(o,e,t)}}},restoreToInitial:function(){if(S.state.configStore){var e=v(S.state.configStore[o]);g.setFormState(o,e),r.G.ifDefined(c,(function(t){return t(p(e))}))}},clearForm:function(){if(S.state.configStore){var e=v(S.state.configStore[o],!0);g.setFormState(o,e),r.G.ifDefined(c,(function(t){return t(p(e))}))}},setFieldError:function(e,t){return g.setFormError(o,e,t)},isFormReady:r.G.hasKeys(m.formState[o])}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-form-builder.umd.production.min.js.map
